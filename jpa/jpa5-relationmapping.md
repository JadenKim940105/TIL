# JPA#5 연관관계 매핑 

---

이 포스팅은 김영한님의 JPA 강의를 듣고, 제 나름대로 다시 공부하고 정리한 포스팅 입니다. 만약, 조금 더 자세한 내용을 듣고 싶으시다면 [이곳의 강의](https://www.inflearn.com/users/@yh) 를 참고해보시기 바랍니다

---

### 연관관계 매핑시 고려사항

- 다중성 : N:1, 1:N, 1:1, N:M  
  (실무에서 N:M 관계의 사용은 고려할 것.)
- 단방향, 양방향  
  테이블은 외래키로 양쪽에서 조인이 가능. -> 방향의 개념이 없다.  
  객체는 참조용 필드가 있는 쪽으로만 참조 가능(한쪽만 참조하면 단방향, 양쪽이 서로 참조하면 양방향)
- 연관관계의 주인  
  객체 입장에서 양방향 관계를 걸면 참조가 2군데. 둘 중 테이블 외래키를 관리할 곳을 지정. (연관관계 주인 = 외래키를 관리하는 쪽)
  

### 다대일[N:1]
```java
N 쪽이 연관관계의 주인이 되는 설계
외래키를 가진 쪽이 연관관계의 주인
```

### 일대다[1:N]
```java
1 쪽이 연관관계의 주인이 되는 설계
외래키를 가지지 않은 쪽이 연관관계의 주인
@JoinColumn 을 사용하지 않으면 조인 테이블 방식을 사용하게됨 
외래키는 언제나 N쪽이 가짐으로 1쪽에서 변경을 하면 N쪽에 쿼리가 날라감 
일대다 단방향 설계는 다대일 양방향 설계로의 변환을 고려해볼 것.
```


### 일대일[1:1]
```text
일대일 관계는 그 반대도 일대일
주 테이블이나 대상 테이블 중에 어디에나 외래키를 넣을 수 있다.
외래키에 데이터베이스 유니크 제약조건 추가. 
```


### 다대다[N:M]
```text
관계형 데이터베이스는 정규화된 테이블 2개로 다대다 관계를 표현할 수 없음으로
연결테이블을 추가해서 일대다, 다대일 관계로 풀어야한다. 
객체는 컬렉션을 사용해서 다대다 관계가 가능하다. 

@ManyToMany 를 사용해서 연결테이블을 생성하면 테이블에는 매핑정보만 들어가고, 추가정보를 넣을 수 없다.
그렇기 떄문에 다대다 관계에서 연결 테이블을 엔티티로 승격시켜 두개의 ManyToOne, OneToMany 관계로 풀어내는 것을 고려한다.
```