# 테코톡#2 리눅스 메모리 관리

---

해당 포스팅은 우아한Tech의 테크토크 [리눅스 메모리 관리 -그니](https://www.youtube.com/watch?v=OPdjLaW0flU) 영상을 참고하여 재구성 하였습니다.

---

### 리눅스(Linux)?

리눅스란 리누스 토르발스가 커뮤니티 주체로 개발한 컴퓨터 운영체제이다... 리눅스는 자유 소프트웨어와 오픈소스 개발의 가장 유명한 표본으로 들 수 있다.
리눅스는 다중 사용자, 다중 작업, 다중 스레드를 지원하는 네트워크 운영체제(NOS) 이다.  


### 메모리(Memory)?
넓은 의미로는 모든 기억장치를 의미하고 좁은 의미로는 메인 메모리(RAM) 을 의미한다. 해당 포스팅에서의 메모리는 좁은 의미의 메인 메모리를 지칭한다.
컴퓨터에서 메모리는 유일한 작업공간 이라고도 하는데, 프로세느는 CPU에서 바로 계산을 할 수 없고, 반드시 메모리에 적재된 후에 실행이 가능함을 의미한다.


### 리눅스 메모리 관리?
작업공간을 필요로 하는 프로세스를 위해 운영체제인 리눅스가 메인 메모리를 관리하고 운영하는 방법 

### 메모리 오버레이 (Memory Overlay)
만약 프로세스 크기보다 할당받은 메모리의 크기가 작다면?  
(메모리에서 1MB 크기만 할당받았는데, 2MB 프로그램을 어떻게 실행할 수 있을까?)  

=> 프로그램의 크기가 할당 받은 메모리 보다 클 떄 프로그램 전체를 메모리에 올리지 않고 적당한 크기로 잘라서 올리는 기법을
메모리 오버레이(Memory Overlay) 라고한다.


### 가상 메모리
메모리 오버레이 기법을 사용하는 경우 실제 메모리에 적재되지 않은 부분은 어디에 보관할까?  
리눅스에서는 보조메모리로 하드디스크나 SSD 같은 보조기억장치를 사용한다. 

이렇게 **_실제 디스크를 마치 메모리 처럼 사용하는 것을 가상 메모리_** 라고하며 프로세스 입장에서는 디스크 공간이 아닌
실제 메모리로 인식한다. 

* 페이지(page) : 가상 메모리 시스템에서 메모리를 다룰 떄 사용하는 최소 크기 단위, 리눅스는 4kb 를 사용한다. 
* 스왑아웃(swap out) : 메인 메모리의 프로세스에서 일정 페이지를 잘라서 가상메모리로 가져가는 것 
* 스왑인(swap in) : 가상 메모리에 옮겨 두었던 프로세스 페이지를 다시 메인메로리로 가져오는 것 

성능 관점에서 가상 메모리를 사용하면 가상 메모리와 메모리를 스왑하는 비용 떄문에 성능 저하가 발생한다.
따라서, **_스와핑이 발생하지 않도록 메모리 여유을을 유지하는 것이 성능에 중요_** 하다. 

안정적인 운영을 위한 메모리 판단 기준은 
1. 메모리 사용율 100% 이하
2. 지속적으로 스왑 아웃이 발생하면 메모리 부족 

vmstat 라는 명령어로 쉽게 모니터링 할 수 있다.  
해당명령어를 치면 다음과 같은 화면을 볼 수 있는데, 여기서 free 는 남은 메모리 여유공간을 의미하고,
so 는 스왑아웃 횟수를 의미한다.
![vmstat](https://github.com/JadenKim940105/TIL/blob/master/techtalk/img/vmstat.png)

참고로 vmstat [딜레이] [횟수] 와 같이 사용이 가능한데 이런 설정을 통해 딜레이 간격만큼 횟수만큼 출력이 가능하다. 
(횟수 생략시 무한히 계속된다)

vmstat 1 >> log.txt   
1초마다 한번씩 모니터링 상황을 log.txt 파일에 로그로 남길 수 있다. 


### 파일 캐시
파일I/O 는 속도가 느린 디스크 리소스를 사용하는 작업이다. 떄문에 파일 I/O 작업이 많이 발생하면, 성능이 떨어지게 된다. 
이룰 개선하기 위해 리눅스에서는 한번 읽은 파일의 내용을 캐시해 두었다 사용한다.   
-> buff / cache 


buff 와 cache 의 차이는 ?

buff 는 파일 시스템의 메타 데이터와 관련된 블록들을 저장하고 있는 캐시이고, 
cache 는 파일의 내용을 저장하고 있는 캐시이다.


'실무로 배우는 시스템 성능 최적화' 를 인용하자면 WAS 서버의 경우 파일 캐시에 의한 성능 개선 사례는 
경험하기 힘들 정도로 성능에 큰 영향을 미치지 않는다고 한다. 때문에 파일 캐시는 전체 메모리 대비 최대 크기를
30% 이하로 유지하는 것을 권고하고 있다.

